<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulacro Matem√°ticas S3 - Evaluaci√≥n ICFES Aleatorio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
        }

        .container {
            display: flex;
            width: 100%;
            min-height: 100vh;
        }

        .sidebar-left {
            width: 300px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .main-content {
            flex: 1;
            margin-left: 300px;
            margin-right: 250px;
            padding: 40px 20px;
        }

        .sidebar-right {
            width: 250px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            position: fixed;
            right: 0;
            height: 100vh;
            overflow-y: auto;
        }

        .student-info h2 {
            color: #2196f3;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .student-name-display {
            background: linear-gradient(45deg, #2196f3, #21cbf3);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .progress-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .progress-bar {
            background: #e0e0e0;
            border-radius: 20px;
            height: 25px;
            position: relative;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4caf50, #81c784);
            height: 100%;
            border-radius: 20px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .progress-inner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .page-indicator, .score-display {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .score-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #2196f3;
            margin: 10px 0;
        }

        .page {
            display: none;
            animation: fadeIn 0.5s;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .exercise-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            max-width: 900px;
            margin: 0 auto;
        }

        .exercise-card h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.8em;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .icon {
            margin-right: 10px;
            font-size: 1.2em;
        }

        .equation {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
        }

        .radio-group {
            margin: 25px 0;
        }

        .radio-group label {
            display: block;
            margin: 12px 0;
            padding: 15px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
        }

        .radio-group label:hover {
            background: #e3f2fd;
            border-color: #2196f3;
            transform: translateX(5px);
        }

        .radio-group input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.2);
        }

        .submit-btn {
            background: linear-gradient(45deg, #4caf50, #45a049);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .submit-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            display: none;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .table-container {
            margin: 20px 0;
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }

        .data-table th {
            background: linear-gradient(45deg, #2196f3, #21cbf3);
            color: white;
            font-weight: bold;
        }

        .data-table tr:hover {
            background: #f5f5f5;
        }

        .figure-diagram {
            width: 100%;
            max-width: 400px;
            height: 300px;
            margin: 20px auto;
            display: block;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
        }

        .welcome-container {
            text-align: center;
            color: white;
        }

        .welcome-container h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .student-input {
            padding: 15px;
            font-size: 1.2em;
            border: 3px solid #ddd;
            border-radius: 25px;
            width: 300px;
            text-align: center;
            margin: 20px;
            transition: border-color 0.3s ease;
        }

        .student-input:focus {
            outline: none;
            border-color: #2196f3;
            box-shadow: 0 0 20px rgba(33, 150, 243, 0.3);
        }

        .start-btn {
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1.3em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 20px;
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.3);
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }

        .nav-btn {
            background: linear-gradient(45deg, #2196f3, #21cbf3);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            margin: 5px 0;
            width: 100%;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
        }

        .nav-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .results-container {
            text-align: center;
            color: white;
        }

        .final-score {
            font-size: 4em;
            font-weight: bold;
            color: #4caf50;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin: 30px 0;
        }

        .performance-message {
            font-size: 1.5em;
            font-weight: bold;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .performance-message.excellent {
            background: linear-gradient(45deg, #4caf50, #81c784);
        }

        .performance-message.good {
            background: linear-gradient(45deg, #2196f3, #64b5f6);
        }

        .performance-message.needs-improvement {
            background: linear-gradient(45deg, #ff9800, #ffb74d);
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .achievement {
            background: white;
            color: #2c3e50;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .achievement.gold {
            border-top: 5px solid #ffd700;
        }

        .achievement.silver {
            border-top: 5px solid #c0c0c0;
        }

        .achievement.bronze {
            border-top: 5px solid #cd7f32;
        }

        .buttons-container {
            margin: 40px 0;
            text-align: center;
        }

        .download-btn,
        .restart-btn {
            background: linear-gradient(45deg, #9c27b0, #e91e63);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .download-btn:hover,
        .restart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(156, 39, 176, 0.4);
        }

        .navigation-controls h3 {
            color: #2196f3;
            margin-bottom: 15px;
        }

        .procedure-box {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #2196f3;
        }

        .randomization-indicator {
            background: linear-gradient(45deg, #ff9800, #ffb74d);
            color: white;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(255, 152, 0, 0.3);
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar-left,
            .sidebar-right {
                position: relative;
                width: 100%;
                height: auto;
            }
            
            .main-content {
                margin: 0;
                padding: 20px 10px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <!-- Sidebar Izquierdo - Informaci√≥n del Estudiante -->
    <div class="sidebar-left">
        <div class="student-info">
            <h2>üë§ Estudiante</h2>
            <div class="student-name-display" id="sidebarStudentName">Sin nombre</div>
            
            <div class="randomization-indicator">
                üé≤ Modo Aleatorio Activado
            </div>
            
            <div class="progress-container">
                <h3>üìä Progreso General</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                    <div class="progress-inner" id="progressText">0%</div>
                </div>
            </div>
            
            <div class="page-indicator">
                <h3>Pregunta Actual</h3>
                <p id="currentPageName">Inicio</p>
                <p><span id="currentPageNum">0</span> de <span id="totalPages">11</span></p>
            </div>
            
            <div class="score-display">
                <h4>Puntuaci√≥n</h4>
                <div class="score-number" id="currentScore">0</div>
                <p>de 100 puntos</p>
            </div>
        </div>
    </div>

    <!-- Contenido Principal -->
    <div class="main-content">
        <!-- P√°gina 0: Bienvenida -->
        <div class="page active" id="page0">
            <div class="welcome-container">
                <h2>üéØ ¬°Bienvenido al Simulacro Matem√°ticas S3!</h2>
                <p style="font-size: 1.2em; margin: 20px 0;">Tercera evaluaci√≥n con orden aleatorio de preguntas y respuestas para una experiencia √∫nica cada vez.</p>
                <div style="background: rgba(255, 255, 255, 0.1); padding: 25px; border-radius: 15px; margin: 30px 0;">
                    <h3>üìã Instrucciones:</h3>
                    <ul style="text-align: left; max-width: 450px; margin: 20px auto; color: white;">
                        <li>üé≤ <strong>Orden aleatorio:</strong> Las preguntas y respuestas cambian cada vez</li>
                        <li>üìù Completa 10 preguntas de selecci√≥n m√∫ltiple</li>
                        <li>üß† Cada pregunta eval√∫a competencias espec√≠ficas</li>
                        <li>üìä Visualiza tu desempe√±o personalizado al final</li>
                    </ul>
                </div>
                <h3>üë§ Ingresa tu nombre completo:</h3>
                <input class="student-input" id="studentName" maxlength="50" placeholder="Escribe tu nombre aqu√≠" type="text"/>
                <br/>
                <button class="start-btn" onclick="startEvaluation()">üöÄ Comenzar Simulacro Aleatorio</button>
            </div>
        </div>

        <!-- Las p√°ginas de preguntas se generar√°n din√°micamente -->

        <!-- P√°gina 11: Resultados -->
        <div class="page" id="page11">
            <div class="results-container" id="certificateContent">
                <h2>üéì ¬°Simulacro S3 Completado!</h2>
                <div class="student-name-display" id="finalStudentName"></div>
                <div style="text-align: center; margin: 20px 0; padding: 15px; background: rgba(255, 255, 255, 0.1); border-radius: 15px; border: 2px solid #fff;">
                    <h3 style="color: white; margin: 0;">üìÖ Fecha de Evaluaci√≥n: <span id="evaluationDate"></span></h3>
                    <h3 style="color: white; margin: 10px 0 0 0;">üè´ Evaluaci√≥n: Simulacro Matem√°ticas S3 - ICFES (Aleatorio)</h3>
                </div>
                <div class="final-score" id="finalScore">0/100</div>
                <div class="performance-message" id="performanceMessage"></div>
                
                <h3 style="color: white;">üèÜ Reconocimientos y Logros Obtenidos</h3>
                <div class="achievements-grid" id="achievementsContainer"></div>
                
                <h3 style="color: white;">üìä Desglose Detallado por Competencia</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0;">
                    <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <h4>Razonamiento Cuantitativo</h4>
                        <div id="reasoningScore" style="font-size: 2em; color: #2196f3; font-weight: bold;">0/40</div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <h4>Competencia Geom√©trica</h4>
                        <div id="geometryScore" style="font-size: 2em; color: #4caf50; font-weight: bold;">0/30</div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <h4>Estad√≠stica y Probabilidad</h4>
                        <div id="statisticsScore" style="font-size: 2em; color: #ff9800; font-weight: bold;">0/30</div>
                    </div>
                </div>
                
                <div style="margin: 40px 0; padding: 20px; background: rgba(255, 255, 255, 0.1); border-radius: 15px; border: 2px solid #fff;">
                    <h4 style="color: white; margin: 0 0 10px 0;">üí° Recomendaciones para el ICFES:</h4>
                    <div id="recommendations" style="text-align: left; line-height: 1.8; color: white;"></div>
                </div>
                
                <div class="buttons-container">
                    <button class="download-btn" onclick="downloadCertificate()">üìÑ Descargar Certificado PDF</button>
                    <button class="restart-btn" onclick="restartEvaluation()">üîÑ Nueva Evaluaci√≥n Aleatoria</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar Derecho - Navegaci√≥n -->
    <div class="sidebar-right">
        <div class="navigation-controls">
            <h3>üì± Navegaci√≥n</h3>
            <button class="nav-btn" disabled id="prevBtn" onclick="previousPage()">‚¨ÖÔ∏è Anterior</button>
            <button class="nav-btn" id="nextBtn" onclick="nextPage()">Siguiente ‚û°Ô∏è</button>
            <button class="nav-btn" id="resultsBtn" onclick="showResults()" style="display: none;">üìä Ver Resultados</button>
            
            <div style="margin: 30px 0; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <h4>üìã Preguntas</h4>
                <div style="font-size: 0.9em; line-height: 1.8;" id="questionsList">
                    <!-- Las preguntas se generar√°n din√°micamente -->
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Variables globales
    let studentName = '';
    let currentPage = 0;
    let totalScore = 0;
    let questionsAnswered = 0;
    let questionScores = {};
    let randomizedQuestions = [];
    let questionOrder = [];
    
    // Base de datos de preguntas
    const questionBank = [
        {
            id: 'mediana_datos',
            title: 'An√°lisis de Mediana',
            icon: 'üìä',
            topic: 'Estad√≠stica',
            competency: 'statistics',
            content: `
                <p>Se tienen los siguientes datos de una muestra: 46, 54, 42, 48, 32. Para calcular la mediana se debe seguir un procedimiento espec√≠fico.</p>
                <div class="equation">
                    Datos: 46, 54, 42, 48, 32<br/>
                    Mediana = valor central despu√©s de ordenar
                </div>
                <h3>¬øCu√°l es la mediana de estos datos?</h3>
            `,
            options: [
                { text: '42', correct: false },
                { text: '46', correct: true },
                { text: '48', correct: false },
                { text: '44', correct: false }
            ],
            explanation: {
                correct: '¬°Correcto! Ordenando: 32, 42, 46, 48, 54. La mediana es el valor central: 46.',
                incorrect: 'Incorrecto. Debes ordenar los datos de menor a mayor y tomar el valor central.'
            }
        },
        {
            id: 'funcion_cuadratica',
            title: 'Funci√≥n Cuadr√°tica',
            icon: 'üìà',
            topic: '√Ålgebra',
            competency: 'reasoning',
            content: `
                <p>Dada la funci√≥n cuadr√°tica y = x¬≤ - 6x + 5, se requiere determinar las coordenadas del v√©rtice.</p>
                <div class="equation">
                    y = x¬≤ - 6x + 5<br/>
                    V√©rtice: h = -b/(2a), k = f(h)
                </div>
                <h3>¬øCu√°les son las coordenadas del v√©rtice de esta par√°bola?</h3>
            `,
            options: [
                { text: '(3, -4)', correct: true },
                { text: '(-3, 4)', correct: false },
                { text: '(6, 5)', correct: false },
                { text: '(0, 5)', correct: false }
            ],
            explanation: {
                correct: '¬°Correcto! h = -(-6)/(2√ó1) = 3, k = 3¬≤ - 6(3) + 5 = 9 - 18 + 5 = -4.',
                incorrect: 'Incorrecto. Usa la f√≥rmula h = -b/(2a) y luego eval√∫a f(h) para encontrar k.'
            }
        },
        {
            id: 'par√°bola_desplazamiento',
            title: 'Desplazamiento de Par√°bolas',
            icon: 'üîÑ',
            topic: 'Transformaciones',
            competency: 'reasoning',
            content: `
                <p>Si la funci√≥n y = x¬≤ se desplaza 4 unidades hacia la derecha y 3 unidades hacia arriba, ¬øcu√°l es la nueva ecuaci√≥n?</p>
                <div class="equation">
                    Funci√≥n original: y = x¬≤<br/>
                    Desplazamiento: 4 unidades derecha, 3 unidades arriba
                </div>
                <h3>¬øCu√°l es la ecuaci√≥n de la funci√≥n transformada?</h3>
            `,
            options: [
                { text: 'y = (x - 4)¬≤ + 3', correct: true },
                { text: 'y = (x + 4)¬≤ + 3', correct: false },
                { text: 'y = (x - 4)¬≤ - 3', correct: false },
                { text: 'y = x¬≤ + 4x + 3', correct: false }
            ],
            explanation: {
                correct: '¬°Correcto! Desplazamiento horizontal hacia la derecha: (x-h), vertical hacia arriba: +k.',
                incorrect: 'Incorrecto. Derecha: (x-h), izquierda: (x+h), arriba: +k, abajo: -k.'
            }
        },
        {
            id: 'moda_datos',
            title: 'C√°lculo de Moda',
            icon: 'üéØ',
            topic: 'Estad√≠stica',
            competency: 'statistics',
            content: `
                <p>En una muestra se tienen los valores: 20, 23, 24, 25, 25, 25, 26, 30.</p>
                <div class="equation">
                    Datos: 20, 23, 24, 25, 25, 25, 26, 30<br/>
                    Moda = valor que m√°s se repite
                </div>
                <h3>¬øCu√°l es la moda de estos datos?</h3>
            `,
            options: [
                { text: '25', correct: true },
                { text: '24', correct: false },
                { text: '23', correct: false },
                { text: 'No hay moda', correct: false }
            ],
            explanation: {
                correct: '¬°Correcto! El valor 25 aparece 3 veces, m√°s que cualquier otro valor.',
                incorrect: 'Incorrecto. La moda es el valor que aparece con mayor frecuencia.'
            }
        },
        {
            id: 'varianza_concepto',
            title: 'Concepto de Varianza',
            icon: 'üìè',
            topic: 'Dispersi√≥n',
            competency: 'statistics',
            content: `
                <p>La varianza mide la dispersi√≥n de los datos respecto a la media. Un conjunto de datos tiene varianza menor cuando:</p>
                <div class="equation">
                    Varianza = Œ£(xi - xÃÑ)¬≤/n<br/>
                    Mayor varianza = Mayor dispersi√≥n
                </div>
                <h3>¬øCu√°ndo un conjunto de datos tiene menor varianza?</h3>
            `,
            options: [
                { text: 'Cuando los datos est√°n m√°s concentrados cerca de la media', correct: true },
                { text: 'Cuando los datos est√°n m√°s alejados de la media', correct: false },
                { text: 'Cuando hay m√°s datos en la muestra', correct: false },
                { text: 'Cuando la media es mayor', correct: false }
            ],
            explanation: {
                correct: '¬°Correcto! Menor varianza indica que los datos est√°n m√°s concentrados cerca de la media.',
                incorrect: 'Incorrecto. La varianza mide qu√© tan dispersos est√°n los datos respecto a la media.'
            }
        },
        {
            id: 'triangulo_rectangulo',
            title: 'Tri√°ngulo Rect√°ngulo',
            icon: 'üìê',
            topic: 'Geometr√≠a',
            competency: 'geometry',
            content: `
                <p>En un tri√°ngulo rect√°ngulo con catetos de 3 cm y 4 cm, ¬øcu√°l es la longitud de la hipotenusa?</p>
                <div class="equation">
                    Teorema de Pit√°goras: c¬≤ = a¬≤ + b¬≤<br/>
                    a = 3 cm, b = 4 cm
                </div>
                <h3>¬øCu√°l es la longitud de la hipotenusa?</h3>
            `,
            options: [
                { text: '5 cm', correct: true },
                { text: '7 cm', correct: false },
                { text: '25 cm', correct: false },
                { text: '12 cm', correct: false }
            ],
            explanation: {
                correct: '¬°Correcto! c¬≤ = 3¬≤ + 4¬≤ = 9 + 16 = 25, entonces c = 5 cm.',
                incorrect: 'Incorrecto. Aplica el teorema de Pit√°goras: c¬≤ = a¬≤ + b¬≤.'
            }
        },
        {
            id: 'area_circulo',
            title: '√Årea del C√≠rculo',
            icon: '‚≠ï',
            topic: 'Geometr√≠a',
            competency: 'geometry',
            content: `
                <p>Se tiene un c√≠rculo con radio de 5 cm. ¬øCu√°l es su √°rea aproximada usando œÄ ‚âà 3.14?</p>
                <div class="equation">
                    √Årea = œÄ √ó r¬≤<br/>
                    r = 5 cm, œÄ ‚âà 3.14
                </div>
                <h3>¬øCu√°l es el √°rea del c√≠rculo?</h3>
            `,
            options: [
                { text: '78.5 cm¬≤', correct: true },
                { text: '31.4 cm¬≤', correct: false },
                { text: '15.7 cm¬≤', correct: false },
                { text: '25 cm¬≤', correct: false }
            ],
            explanation: {
                correct: '¬°Correcto! √Årea = œÄ √ó r¬≤ = 3.14 √ó 5¬≤ = 3.14 √ó 25 = 78.5 cm¬≤.',
                incorrect: 'Incorrecto. Usa la f√≥rmula √Årea = œÄ √ó r¬≤ con r = 5 cm.'
            }
        },
        {
            id: 'probabilidad_basica',
            title: 'Probabilidad B√°sica',
            icon: 'üé≤',
            topic: 'Probabilidad',
            competency: 'statistics',
            content: `
                <p>En una bolsa hay 3 bolas rojas, 2 bolas azules y 1 bola verde. ¬øCu√°l es la probabilidad de sacar una bola roja?</p>
                <div class="equation">
                    P(evento) = casos favorables / casos totales<br/>
                    Rojas = 3, Total = 6
                </div>
                <h3>¬øCu√°l es la probabilidad de sacar una bola roja?</h3>
            `,
            options: [
                { text: '1/2', correct: true },
                { text: '1/3', correct: false },
                { text: '3/6', correct: false },
                { text: '1/6', correct: false }
            ],
            explanation: {
                correct: '¬°Correcto! P(roja) = 3/6 = 1/2. Hay 3 bolas rojas de un total de 6 bolas.',
                incorrect: 'Incorrecto. Probabilidad = casos favorables / casos totales = 3/6 = 1/2.'
            }
        },
        {
            id: 'combinaciones',
            title: 'Combinaciones',
            icon: 'üî¢',
            topic: 'Combinatoria',
            competency: 'reasoning',
            content: `
                <p>¬øDe cu√°ntas formas se pueden escoger 3 estudiantes de un grupo de 5?</p>
                <div class="equation">
                    C(n,r) = n! / (r!(n-r)!)<br/>
                    C(5,3) = 5! / (3!√ó2!)
                </div>
                <h3>¬øCu√°ntas combinaciones son posibles?</h3>
            `,
            options: [
                { text: '10', correct: true },
                { text: '15', correct: false },
                { text: '20', correct: false },
                { text: '60', correct: false }
            ],
            explanation: {
                correct: '¬°Correcto! C(5,3) = 5!/(3!√ó2!) = (5√ó4√ó3!)/(3!√ó2√ó1) = 20/2 = 10.',
                incorrect: 'Incorrecto. Usa la f√≥rmula de combinaciones: C(n,r) = n!/(r!(n-r)!).'
            }
        },
        {
            id: 'volumen_cilindro',
            title: 'Volumen de Cilindro',
            icon: 'ü•§',
            topic: 'Geometr√≠a 3D',
            competency: 'geometry',
            content: `
                <p>Un cilindro tiene un radio de 2 cm y una altura de 10 cm. ¬øCu√°l es su volumen usando œÄ ‚âà 3.14?</p>
                <div class="equation">
                    V = œÄ √ó r¬≤ √ó h<br/>
                    r = 2 cm, h = 10 cm, œÄ ‚âà 3.14
                </div>
                <h3>¬øCu√°l es el volumen del cilindro?</h3>
            `,
            options: [
                { text: '125.6 cm¬≥', correct: true },
                { text: '62.8 cm¬≥', correct: false },
                { text: '31.4 cm¬≥', correct: false },
                { text: '40 cm¬≥', correct: false }
            ],
            explanation: {
                correct: '¬°Correcto! V = œÄ √ó r¬≤ √ó h = 3.14 √ó 2¬≤ √ó 10 = 3.14 √ó 4 √ó 10 = 125.6 cm¬≥.',
                incorrect: 'Incorrecto. Usa la f√≥rmula V = œÄ √ó r¬≤ √ó h con los valores dados.'
            }
        }
    ];
    
    function shuffleArray(array) {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
    }
    
    function initializeRandomizedQuestions() {
        // Aleatorizar el orden de las preguntas
        randomizedQuestions = shuffleArray(questionBank);
        
        // Para cada pregunta, aleatorizar las opciones
        randomizedQuestions.forEach((question, index) => {
            const shuffledOptions = shuffleArray(question.options);
            question.shuffledOptions = shuffledOptions;
            
            // Encontrar la nueva posici√≥n de la respuesta correcta
            const correctIndex = shuffledOptions.findIndex(opt => opt.correct);
            const letters = ['A', 'B', 'C', 'D'];
            question.correctAnswer = letters[correctIndex];
            
            // Crear ID √∫nico para el tracking
            question.trackingId = `q${index + 1}`;
            questionScores[question.trackingId] = 0;
        });
        
        // Generar el orden de p√°ginas
        questionOrder = randomizedQuestions.map((_, index) => index + 1);
    }
    
    function generateQuestionPages() {
        const mainContent = document.querySelector('.main-content');
        
        randomizedQuestions.forEach((question, index) => {
            const pageNum = index + 1;
            const pageHTML = `
                <div class="page" id="page${pageNum}">
                    <div class="exercise-card">
                        <h2><span class="icon">${question.icon}</span>Pregunta ${pageNum}: ${question.title}</h2>
                        ${question.content}
                        
                        <div class="radio-group">
                            ${question.shuffledOptions.map((option, optIndex) => {
                                const letter = ['A', 'B', 'C', 'D'][optIndex];
                                return `<label><input type="radio" name="${question.trackingId}" value="${letter}"/> ${letter}. ${option.text}</label>`;
                            }).join('')}
                        </div>
                        
                        <button class="submit-btn" onclick="checkQuestion(${pageNum}, '${question.correctAnswer}')" id="submit${question.trackingId}">‚úÖ Verificar Respuesta</button>
                        <div class="feedback" id="feedback${question.trackingId}"></div>
                    </div>
                </div>
            `;
            
            // Insertar antes de la p√°gina de resultados
            const resultsPage = document.getElementById('page11');
            resultsPage.insertAdjacentHTML('beforebegin', pageHTML);
        });
        
        // Actualizar la lista de preguntas en el sidebar
        updateQuestionsList();
    }
    
    function updateQuestionsList() {
        const questionsList = document.getElementById('questionsList');
        questionsList.innerHTML = randomizedQuestions.map((question, index) => 
            `<div id="${question.trackingId}status">${index + 1}. ${question.topic} ‚è≥</div>`
        ).join('');
    }

    function startEvaluation() {
        const nameInput = document.getElementById('studentName');
        studentName = nameInput.value.trim();
        
        if (studentName === '') {
            alert('Por favor, ingresa tu nombre para continuar.');
            return;
        }
        
        document.getElementById('sidebarStudentName').textContent = studentName;
        
        // Inicializar preguntas aleatorias
        initializeRandomizedQuestions();
        generateQuestionPages();
        
        showPage(1);
    }

    function showPage(pageNum) {
        document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
        document.getElementById(`page${pageNum}`).classList.add('active');
        
        currentPage = pageNum;
        updateNavigation();
        updateProgress();
    }

    function nextPage() {
        if (currentPage < 11) {
            showPage(currentPage + 1);
        }
    }

    function previousPage() {
        if (currentPage > 0) {
            showPage(currentPage - 1);
        }
    }

    function updateNavigation() {
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        
        prevBtn.disabled = currentPage === 0;
        nextBtn.disabled = currentPage === 11;
        
        if (currentPage === 11) {
            nextBtn.style.display = 'none';
        } else {
            nextBtn.style.display = 'inline-block';
        }
        
        const pageNames = ['Inicio', ...randomizedQuestions.map(q => q.topic), 'Resultados'];
        document.getElementById('currentPageName').textContent = pageNames[currentPage] || 'Pregunta';
        document.getElementById('currentPageNum').textContent = currentPage;
    }

    function updateProgress() {
        const percentage = (questionsAnswered / 10) * 100;
        document.getElementById('progressFill').style.width = percentage + '%';
        document.getElementById('progressText').textContent = Math.round(percentage) + '%';
        document.getElementById('currentScore').textContent = totalScore;
    }

    function checkQuestion(pageNum, correctAnswer) {
        const question = randomizedQuestions[pageNum - 1];
        const selectedRadio = document.querySelector(`input[name="${question.trackingId}"]:checked`);
        
        if (!selectedRadio) {
            alert('Por favor, selecciona una respuesta antes de verificar.');
            return;
        }
        
        const isCorrect = selectedRadio.value === correctAnswer;
        const feedbackEl = document.getElementById(`feedback${question.trackingId}`);
        const submitBtn = document.getElementById(`submit${question.trackingId}`);
        
        // Marcar respuesta correcta e incorrecta
        document.querySelectorAll(`input[name="${question.trackingId}"]`).forEach(radio => {
            radio.disabled = true;
            if (radio.value === correctAnswer) {
                radio.parentElement.style.background = '#d4edda';
                radio.parentElement.style.borderColor = '#28a745';
            } else if (radio.checked && radio.value !== correctAnswer) {
                radio.parentElement.style.background = '#f8d7da';
                radio.parentElement.style.borderColor = '#dc3545';
            }
        });
        
        // Actualizar puntuaci√≥n
        if (isCorrect) {
            questionScores[question.trackingId] = 10;
            totalScore += 10;
            feedbackEl.className = 'feedback correct';
        } else {
            questionScores[question.trackingId] = 0;
            feedbackEl.className = 'feedback incorrect';
        }
        
        questionsAnswered++;
        feedbackEl.style.display = 'block';
        
        const explanation = isCorrect ? question.explanation.correct : question.explanation.incorrect;
        feedbackEl.textContent = `${explanation} (${questionScores[question.trackingId]}/10 puntos)`;
        
        submitBtn.disabled = true;
        updateQuestionStatus(question.trackingId, isCorrect);
        updateProgress();
        
        if (questionsAnswered === 10) {
            document.getElementById('resultsBtn').style.display = 'inline-block';
        }
    }

    function updateQuestionStatus(trackingId, isCorrect) {
        const statusEl = document.getElementById(`${trackingId}status`);
        const currentText = statusEl.textContent;
        const questionText = currentText.replace(/[‚úÖ‚ùå‚è≥]/g, '').trim();
        statusEl.innerHTML = `${questionText} ${isCorrect ? '‚úÖ' : '‚ùå'}`;
    }

    function showResults() {
        // Actualizar informaci√≥n final
        document.getElementById('finalStudentName').textContent = studentName;
        document.getElementById('finalScore').textContent = `${totalScore}/100`;
        document.getElementById('evaluationDate').textContent = new Date().toLocaleDateString();
        
        // Calcular puntuaciones por competencia
        let reasoningScore = 0;
        let geometryScore = 0;
        let statisticsScore = 0;
        
        randomizedQuestions.forEach(question => {
            const score = questionScores[question.trackingId];
            switch(question.competency) {
                case 'reasoning':
                    reasoningScore += score;
                    break;
                case 'geometry':
                    geometryScore += score;
                    break;
                case 'statistics':
                    statisticsScore += score;
                    break;
            }
        });
        
        document.getElementById('reasoningScore').textContent = `${reasoningScore}/40`;
        document.getElementById('geometryScore').textContent = `${geometryScore}/30`;
        document.getElementById('statisticsScore').textContent = `${statisticsScore}/30`;
        
        // Generar mensaje de rendimiento
        const percentage = (totalScore / 100) * 100;
        const messageEl = document.getElementById('performanceMessage');
        const recommendationsEl = document.getElementById('recommendations');
        
        if (percentage >= 80) {
            messageEl.className = 'performance-message excellent';
            messageEl.textContent = 'üèÜ ¬°EXCELENTE! Tienes un dominio sobresaliente de las competencias matem√°ticas.';
            recommendationsEl.innerHTML = `
                <p>‚Ä¢ Contin√∫a practicando con simulacros completos del ICFES</p>
                <p>‚Ä¢ Enf√≥cate en optimizar tu velocidad de resoluci√≥n</p>
                <p>‚Ä¢ Revisa estrategias avanzadas de eliminaci√≥n de respuestas</p>
            `;
        } else if (percentage >= 60) {
            messageEl.className = 'performance-message good';
            messageEl.textContent = 'üëç ¬°BUEN TRABAJO! Tienes una base s√≥lida. Fortalece las √°reas de menor puntaje.';
            recommendationsEl.innerHTML = `
                <p>‚Ä¢ Refuerza las competencias con menor puntuaci√≥n</p>
                <p>‚Ä¢ Practica m√°s ejercicios de razonamiento cuantitativo</p>
                <p>‚Ä¢ Resuelve problemas contextualizados similares al ICFES</p>
            `;
        } else {
            messageEl.className = 'performance-message needs-improvement';
            messageEl.textContent = 'üìö REQUIERE MEJORA. Te recomendamos reforzar los conceptos fundamentales.';
            recommendationsEl.innerHTML = `
                <p>‚Ä¢ Repasa los conceptos b√°sicos de cada competencia</p>
                <p>‚Ä¢ Solicita apoyo acad√©mico en las √°reas m√°s d√©biles</p>
                <p>‚Ä¢ Dedica m√°s tiempo al estudio de matem√°ticas</p>
            `;
        }
        
        generateAchievements();
        showPage(11);
    }

    function generateAchievements() {
        const achievements = [];
        const percentage = (totalScore / 100) * 100;
        
        if (percentage >= 90) {
            achievements.push({
                icon: 'üèÜ',
                title: 'Excelencia Matem√°tica',
                description: 'Dominio sobresaliente del simulacro',
                class: 'gold'
            });
        } else if (percentage >= 80) {
            achievements.push({
                icon: '‚≠ê',
                title: 'Preparado para ICFES',
                description: 'Excelente nivel matem√°tico',
                class: 'gold'
            });
        } else if (percentage >= 70) {
            achievements.push({
                icon: 'üëç',
                title: 'Buen Nivel Matem√°tico',
                description: 'S√≥lida comprensi√≥n',
                class: 'silver'
            });
        }
        
        // Logro por completar modo aleatorio
        achievements.push({
            icon: 'üé≤',
            title: 'Desaf√≠o Aleatorio',
            description: 'Complet√≥ simulacro en modo aleatorio',
            class: 'bronze'
        });
        
        if (questionsAnswered === 10) {
            achievements.push({
                icon: 'üéØ',
                title: 'Perseverancia',
                description: 'Complet√≥ todas las preguntas',
                class: 'bronze'
            });
        }
        
        // Renderizar logros
        const container = document.getElementById('achievementsContainer');
        container.innerHTML = achievements.map(achievement => `
            <div class="achievement ${achievement.class}">
                <div style="font-size: 2em; margin-bottom: 10px;">${achievement.icon}</div>
                <h4>${achievement.title}</h4>
                <p>${achievement.description}</p>
            </div>
        `).join('');
    }

    function downloadCertificate() {
        // Crear una nueva ventana para el certificado
        const printWindow = window.open('', '_blank');
        
        // Obtener los datos actuales
        const studentNameText = document.getElementById('finalStudentName').textContent;
        const finalScoreText = document.getElementById('finalScore').textContent;
        const evaluationDateText = document.getElementById('evaluationDate').textContent;
        const performanceMessageText = document.getElementById('performanceMessage').textContent;
        const reasoningScoreText = document.getElementById('reasoningScore').textContent;
        const geometryScoreText = document.getElementById('geometryScore').textContent;
        const statisticsScoreText = document.getElementById('statisticsScore').textContent;
        const recommendationsHTML = document.getElementById('recommendations').innerHTML;
        const achievementsHTML = document.getElementById('achievementsContainer').innerHTML;
        
        // HTML del certificado con estilos completos
        const certificateHTML = `
        <!DOCTYPE html>
        <html lang="es">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Certificado - Simulacro Matem√°ticas S3</title>
            <style>
                * { margin: 0; padding: 0; box-sizing: border-box; }
                body {
                    font-family: 'Arial', sans-serif;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    min-height: 100vh;
                    padding: 20px;
                    color: white;
                    -webkit-print-color-adjust: exact;
                    color-adjust: exact;
                }
                .certificate-container { max-width: 800px; margin: 0 auto; text-align: center; }
                .certificate-title { font-size: 2.5em; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
                .student-name-display {
                    background: linear-gradient(45deg, #2196f3, #21cbf3);
                    color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px;
                    font-weight: bold; font-size: 1.2em;
                }
                .evaluation-info {
                    margin: 20px 0; padding: 15px;
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: 15px; border: 2px solid #fff;
                }
                .final-score {
                    font-size: 4em; font-weight: bold; color: #4caf50;
                    text-shadow: 2px 2px 4px rgba(0,0,0,0.3); margin: 30px 0;
                }
                .performance-message {
                    font-size: 1.3em; font-weight: bold; padding: 20px;
                    border-radius: 15px; margin: 20px 0;
                    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
                }
                .performance-message.excellent { background: linear-gradient(45deg, #4caf50, #81c784); }
                .performance-message.good { background: linear-gradient(45deg, #2196f3, #64b5f6); }
                .performance-message.needs-improvement { background: linear-gradient(45deg, #ff9800, #ffb74d); }
                .achievements-grid {
                    display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 20px; margin: 30px 0;
                }
                .achievement {
                    background: white; color: #2c3e50; padding: 20px;
                    border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                }
                .achievement.gold { border-top: 5px solid #ffd700; }
                .achievement.silver { border-top: 5px solid #c0c0c0; }
                .achievement.bronze { border-top: 5px solid #cd7f32; }
                .competency-scores {
                    display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 20px; margin: 30px 0;
                }
                .competency-card {
                    background: white; padding: 20px; border-radius: 15px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center;
                }
                .competency-score { font-size: 2em; font-weight: bold; margin: 10px 0; }
                .score-reasoning { color: #2196f3; }
                .score-geometry { color: #4caf50; }
                .score-statistics { color: #ff9800; }
                .recommendations {
                    margin: 40px 0; padding: 20px;
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: 15px; border: 2px solid #fff;
                }
                .section-title { color: white; font-size: 1.5em; margin: 30px 0 20px 0; }
                .randomization-badge {
                    background: linear-gradient(45deg, #ff9800, #ffb74d);
                    color: white; padding: 10px; border-radius: 10px;
                    margin: 20px 0; font-weight: bold;
                }
            </style>
        </head>
        <body>
            <div class="certificate-container">
                <h1 class="certificate-title">üéì ¬°Simulacro S3 Completado!</h1>
                <div class="student-name-display">${studentNameText}</div>
                
                <div class="randomization-badge">
                    üé≤ Evaluaci√≥n en Modo Aleatorio
                </div>
                
                <div class="evaluation-info">
                    <h3>üìÖ Fecha de Evaluaci√≥n: ${evaluationDateText}</h3>
                    <h3>üè´ Evaluaci√≥n: Simulacro Matem√°ticas S3 - ICFES (Aleatorio)</h3>
                </div>
                
                <div class="final-score">${finalScoreText}</div>
                <div class="performance-message ${getPerformanceClass()}">${performanceMessageText}</div>
                
                <h3 class="section-title">üèÜ Reconocimientos y Logros Obtenidos</h3>
                <div class="achievements-grid">${achievementsHTML}</div>
                
                <h3 class="section-title">üìä Desglose Detallado por Competencia</h3>
                <div class="competency-scores">
                    <div class="competency-card">
                        <h4>Razonamiento Cuantitativo</h4>
                        <div class="competency-score score-reasoning">${reasoningScoreText}</div>
                    </div>
                    <div class="competency-card">
                        <h4>Competencia Geom√©trica</h4>
                        <div class="competency-score score-geometry">${geometryScoreText}</div>
                    </div>
                    <div class="competency-card">
                        <h4>Estad√≠stica y Probabilidad</h4>
                        <div class="competency-score score-statistics">${statisticsScoreText}</div>
                    </div>
                </div>
                
                <div class="recommendations">
                    <h4>üí° Recomendaciones para el ICFES:</h4>
                    ${recommendationsHTML}
                </div>
                
                <div style="margin-top: 40px; padding: 20px; border-top: 2px solid rgba(255,255,255,0.3); font-size: 0.9em; color: rgba(255,255,255,0.8);">
                    <p>Certificado generado autom√°ticamente por el Sistema de Simulacros ICFES</p>
                    <p>Instituci√≥n Educativa - Preparaci√≥n Acad√©mica Integral</p>
                    <p>üé≤ Modalidad: Evaluaci√≥n Aleatoria</p>
                </div>
            </div>
        </body>
        </html>`;
        
        // Escribir el contenido en la nueva ventana
        printWindow.document.write(certificateHTML);
        printWindow.document.close();
        
        // Esperar a que se cargue completamente y luego imprimir
        printWindow.onload = function() {
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 500);
        };
    }
    
    function getPerformanceClass() {
        const percentage = (totalScore / 100) * 100;
        if (percentage >= 80) return 'excellent';
        if (percentage >= 60) return 'good';
        return 'needs-improvement';
    }

    function restartEvaluation() {
        studentName = '';
        currentPage = 0;
        totalScore = 0;
        questionsAnswered = 0;
        questionScores = {};
        randomizedQuestions = [];
        
        document.getElementById('studentName').value = '';
        document.getElementById('sidebarStudentName').textContent = 'Sin nombre';
        
        // Limpiar p√°ginas generadas din√°micamente
        const generatedPages = document.querySelectorAll('.page:not(#page0):not(#page11)');
        generatedPages.forEach(page => page.remove());
        
        document.getElementById('resultsBtn').style.display = 'none';
        showPage(0);
    }

    // Inicializar
    updateProgress();
    updateNavigation();
</script>
</body>
</html>